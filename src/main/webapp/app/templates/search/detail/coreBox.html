<div ng-include="'app/templates/main/partial/detailview_header.html'"></div>

<div id="elementToFocus" tabindex="1" style="outline: 0" ng-arrow-left="detailCtrl.reload({table:'coreBox', left:true})" ng-arrow-right="detailCtrl.reload({table:'coreBox', right:true})" class="panel detailview-page">
    <div class="panel-body" data-ng-if="detailCtrl.results != null">

        <div class="row">
            <div class="col-lg-6"
                 bs-loading-overlay bs-loading-overlay-reference-id="detailView"
                 bs-loading-overlay-template-url="app/templates/main/partial/loading.overlay.html">

                <div class="detailview-title">
                    <h2>
                        <localize en="detailCtrl.results.drillcore__drillcore_en"
                                  et="detailCtrl.results.drillcore__drillcore"/>
                    </h2>
                    <div>
                        {{ 'DETAIL.DRILLCORE.BOX_NUMBER'| translate }} {{ detailCtrl.results.number }}
                    </div>
                </div>

                <div class="row core-box-previous-next" ng-if="detailCtrl.results.id">
                    <a data-toggle="tooltip" title="{{'DETAIL.PREVIOUS_INFO' | translate}}" class="pull-left" href data-ng-click="detailCtrl.reload({table:'coreBox', left:true})">
                        {{ 'DETAIL.PREVIOUS'| translate }}
                    </a>
                    <a data-toggle="tooltip" title="{{'DETAIL.NEXT_INFO' | translate}}" class="pull-right" href data-ng-click="detailCtrl.reload({table:'coreBox', right:true})">
                        {{ 'DETAIL.NEXT'| translate }}
                    </a>
                </div>

                <table class="table table-bordered table-hover table-header-styles">

                    <tbody>
                        <tr data-ng-if="detailCtrl.results.id && detailCtrl.results.id != null">
                            <td> {{ 'DETAIL.CORE_BOX.ID'| translate }} </td>
                            <td> {{ detailCtrl.results.id }} </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.drillcore__drillcore_en && detailCtrl.results.drillcore__drillcore_en != null
                            || detailCtrl.results.drillcore__drillcore && detailCtrl.results.drillcore__drillcore != null">
                            <td>{{ 'DETAIL.CORE_BOX.LOCALITY'| translate }}</td>
                            <td>
                                <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'locality', id: detailCtrl.results.drillcore__locality})">
                                    <localize en="detailCtrl.results.drillcore__drillcore_en" et="detailCtrl.results.drillcore__drillcore"/>
                                </a>
                            </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.number && detailCtrl.results.number != null">
                            <td>{{ 'DETAIL.CORE_BOX.NUMBER'| translate }}</td>
                            <td>{{detailCtrl.results.number}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.number_meters && detailCtrl.results.number_meters != null">
                            <td>{{ 'DETAIL.CORE_BOX.INBOX'| translate }}</td>
                            <td>{{detailCtrl.results.number_meters}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.depth_start && detailCtrl.results.depth_start != null">
                            <td>{{ 'DETAIL.CORE_BOX.SINCE'| translate }}</td>
                            <td>{{detailCtrl.results.depth_start}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.depth_end && detailCtrl.results.depth_end != null">
                            <td>{{ 'DETAIL.CORE_BOX.TO'| translate }}</td>
                            <td>{{detailCtrl.results.depth_end}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.depth_other && detailCtrl.results.depth_other != null">
                            <td>{{ 'DETAIL.CORE_BOX.DEPTH'| translate }}</td>
                            <td>{{detailCtrl.results.depth_other}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.stratigraphy_top__stratigraphy && detailCtrl.results.stratigraphy_top__stratigraphy != null
                            || detailCtrl.results.stratigraphy_top__stratigraphy_en && detailCtrl.results.stratigraphy_top__stratigraphy_en != null">
                            <td>{{ 'DETAIL.CORE_BOX.STRATIGRAPHY_TOP'| translate }}</td>
                            <td>
                                <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'stratigraphy', id: detailCtrl.results.stratigraphy_top_id})">
                                    <localize et="detailCtrl.results.stratigraphy_top__stratigraphy"
                                              en="detailCtrl.results.stratigraphy_top__stratigraphy_en"/>
                                </a>
                            </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.stratigraphy_top_free && detailCtrl.results.stratigraphy_top_free != null">
                            <td> {{ 'DETAIL.CORE_BOX.STRATIGRAPHY_TOP_FREE'| translate }} </td>
                            <td> {{ detailCtrl.results.stratigraphy_top_free }} </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.stratigraphy_base__stratigraphy && detailCtrl.results.stratigraphy_base__stratigraphy != null
                            || detailCtrl.results.stratigraphy_base__stratigraphy_en && detailCtrl.results.stratigraphy_base__stratigraphy_en != null">
                            <td>{{ 'DETAIL.CORE_BOX.STRATIGRAPHY_BASE'| translate }}</td>
                            <td>
                                <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'stratigraphy', id: detailCtrl.results.stratigraphy_base_id})">
                                    <localize et="detailCtrl.results.stratigraphy_base__stratigraphy"
                                              en="detailCtrl.results.stratigraphy_base__stratigraphy_en"/>
                                </a>
                            </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.stratigraphy_base_free && detailCtrl.results.stratigraphy_base_free != null">
                            <td> {{ 'DETAIL.CORE_BOX.STRATIGRAPHY_BASE_FREE'| translate }} </td>
                            <td> {{ detailCtrl.results.stratigraphy_base_free }} </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.location && detailCtrl.results.location != null">
                            <td> {{ 'DETAIL.CORE_BOX.LOCATION'| translate }} </td>
                            <td> {{ detailCtrl.results.location }} </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.remarks && detailCtrl.results.remarks != null">
                            <td> {{ 'DETAIL.CORE_BOX.REMARKS'| translate }} </td>
                            <td> {{ detailCtrl.results.remarks }} </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.date_added && detailCtrl.results.date_added != null">
                            <td> {{ 'DETAIL.CORE_BOX.DATE_ADDED'| translate }} </td>
                            <td> {{ detailCtrl.results.date_added | date:dateFormat }} </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.date_changed && detailCtrl.results.date_changed != null">
                            <td> {{ 'DETAIL.CORE_BOX.DATE_CHANGED'| translate }} </td>
                            <td> {{ detailCtrl.results.date_changed | date:dateFormat }} </td>
                        </tr>

                    </tbody>
                </table>

            </div>


            <div class="col-lg-6 core-box-image">
                <a href title="{{detailCtrl.coreboxImageUrl}}"
                   data-ng-click="detailCtrl.service.openUrlInNewWindow({url: detailCtrl.coreboxImageUrl})">
                    <img spinner-load ng-src="{{detailCtrl.service.getDrillcoreImageUrl({
                                database: detailCtrl.results.database__acronym,
                                id: detailCtrl.results.drillcore__id,
                                filename: detailCtrl.results.drillcoreimage__image,
                                preview: true})}}">
                </a>

                <div class="photo-author">
                    {{ 'DETAIL.CORE_BOX.PHOTO' | translate }}:
                    {{detailCtrl.results.drillcoreimage__agent__agent}} {{detailCtrl.results.drillcoreimage__image_date | date:dateFormat}}
                </div>

                <div>
                    {{'API_TRANSLATION.PHOTO_ARCHIVE.SIZE ' | translate }}:
                    <a href="{{detailCtrl.externalCoreboxImagePath}}/600" target="_blank">600px</a>
                    | <a href="{{detailCtrl.externalCoreboxImagePath}}/1024" target="_blank">1024px</a>
                    | <a href="{{detailCtrl.externalCoreboxImagePath}}/1440" target="_blank">1440px</a>
                    | <a href="{{detailCtrl.externalCoreboxImagePath}}/1600" target="_blank">1600px</a>
                    | <a href="{{detailCtrl.externalCoreboxImagePath}}/1920" target="_blank">1920px</a>
                    | <a href="{{detailCtrl.coreboxImageUrl}}" target="_blank">Original</a>
                </div>
            </div>

            <!-- Related files -->
            <div class="col-lg-6" data-ng-if="detailCtrl.attachmentLink.length > 0">
                <h3> {{ 'DETAIL.DETAIL_ATTACHMENT_LINK' | translate }} </h3>

                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <thead class="styles-for-table-headers">
                        <tr>
                            <th>{{ 'API_TRANSLATION.SAMPLE.ATTACHMENT_LINK.TYPE' | translate }}</th>
                            <th>{{ 'API_TRANSLATION.SAMPLE.ATTACHMENT_LINK.DESCRIPTION' | translate }}</th>
                            <th>{{ 'API_TRANSLATION.SAMPLE.ATTACHMENT_LINK.AUTHOR' | translate }}</th>
                            <th>{{ 'API_TRANSLATION.SAMPLE.ATTACHMENT_LINK.DATE' | translate }}</th>
                            <th></th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr data-ng-repeat="entity in detailCtrl.attachmentLink">
                            <td>
                                <localize et="entity.attachment__type__value" en="entity.attachment__type__value_en" />
                            </td>
                            <td>
                                <localize et="entity.attachment__description" en="entity.attachment__description_en" />
                            </td>
                            <td>
                                <first-not-null values="[entity.attachment__author__agent, entity.attachment__author_free]" />
                            </td>
                            <td> {{ entity.attachment__date_added | date:dateFormat }} </td>
                            <td>
                                <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'attachment', id: entity.attachment__id})">
                                    Link
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Related images -->
            <div class="col-lg-6" data-ng-if="detailCtrl.attachmentLink.length > 0">
                <h3> {{ 'DETAIL.LOCALITY.IMAGES_HEADING'| translate }} </h3>

                <div class="row">

                    <div class="col-md-6 col-xs-6" data-ng-repeat="image in detailCtrl.attachmentLink"
                         data-ng-if="image.attachment__filename.endsWith('png') || image.attachment__filename.endsWith('jpeg') || image.attachment__filename.endsWith('svg') || image.attachment__filename.endsWith('jpg')" >

                        <figure class="margin-bottom-30">

                            <a href="{{detailCtrl.service.getDownloadLink(image.attachment__filename)}}" class="hover-me" data-fancybox="gallery">

                                <div class="img-responsive set-height">
                                    <img class="previewImageDetail img-rounded"
                                         src="{{detailCtrl.service.getDownloadLink(image.attachment__filename)}}" />
                                </div>

                                <!--<show-preview class="img-responsive set-height"-->
                                <!--classes="previewImageDetail img-rounded"-->
                                <!--img-title="[image.author__agent, image.date_taken, image.date_taken_free]"-->
                                <!--img-url="detailCtrl.service.getDownloadLink(image.attachment__filename)" />-->

                            </a>

                        </figure>

                    </div>

                </div>
            </div>

            <!-- Stratigraphic boundaries -->
            <div class="col-lg-6" data-ng-if="detailCtrl.results.stratigraphicBoundaries.count > 0">
                <h3> {{ 'DETAIL.CORE_BOX.STRATIGRAPHIC_BOUNDARIES' | translate }} </h3>

                <table class="table table-bordered table-hover">
                    <thead class="styles-for-table-headers">
                        <tr>
                            <th> {{ 'DETAIL.CORE_BOX.STRATIGRAPHY' | translate }} </th>
                            <th> {{ 'DETAIL.CORE_BOX.BASE' | translate }} </th>
                            <th> {{ 'SEARCH.SAMPLES.AGENT' | translate }} </th>
                            <th> {{ 'DETAIL.CORE_BOX.REFERENCE' | translate }} </th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr data-ng-repeat="stratigraphy in detailCtrl.results.stratigraphicBoundaries.results">
                            <td>
                                <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'stratigraphy', id: stratigraphy.stratigraphy_id})">
                                    <localize et="stratigraphy.stratigraphy__stratigraphy" en="stratigraphy.stratigraphy__stratigraphy_en" />
                                </a>
                            </td>

                            <td>{{ stratigraphy.depth_base }}</td>

                            <td>{{ stratigraphy.agent__agent }}</td>

                            <td>
                                <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'reference', id: stratigraphy.reference_id})">
                                    {{ stratigraphy.reference__reference }}
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>


            <div class="col-lg-6" data-ng-if="detailCtrl.results.samplesFromBox.count > 0">
                <h3> {{ 'DETAIL.CORE_BOX.SAMPLES' | translate }} </h3>

                <table class="table table-bordered table-hover">
                    <thead class="styles-for-table-headers">
                        <tr>
                            <th> {{ 'SEARCH.SAMPLES.NUMBER' | translate }} </th>
                            <th> {{ 'SEARCH.SAMPLES.AGENT' | translate }} </th>
                            <th> {{ 'SEARCH.SAMPLES.DATE' | translate }} </th>
                            <th> {{ 'SEARCH.SAMPLES.PURPOSE' | translate }} </th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr data-ng-repeat="sample in detailCtrl.results.samplesFromBox.results">
                            <td>
                                <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'sample', id: sample.id})">
                                    <first-not-null values="[sample.number, sample.id]" />
                                </a>
                            </td>

                            <td><first-not-null values="[sample.agent_collected__agent, sample.agent_collected_free]" /></td>

                            <td>{{ sample.date_added | date:dateFormat }}</td>

                            <td>
                                <localize en="sample.sample_purpose__value_en" et="sample.sample_purpose__value" />
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>

    </div>

    <div data-ng-if="detailCtrl.results == null && pageHasError" ng-include="'app/templates/main/detailview_error.html'"></div>

</div>

<div ng-include="'app/templates/main/partial/detailview_footer.html'"></div>

<script>
    $(function(){
        $('#elementToFocus').focus();
    });
</script>