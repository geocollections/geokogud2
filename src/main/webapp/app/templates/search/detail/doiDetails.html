<div ng-include="'app/templates/main/partial/detailview_header.html'"></div>

<div id="elementToFocus" tabindex="1" style="outline: 0" ng-arrow-left="detailCtrl.reload({table:'doi', left:true})" ng-arrow-right="detailCtrl.reload({table:'doi', right:true})"  class="panel detailview-page">
    <div class="panel-body detailview-max-width" data-ng-if="detailCtrl.results != null">

        <div class="row">
            <div class="col-sm-12">
                <div class="detailview-title">
                    <h2>
                        {{detailCtrl.results.identifier}}: {{detailCtrl.results.title}}
                    </h2>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6" bs-loading-overlay bs-loading-overlay-reference-id="detailView" bs-loading-overlay-template-url="app/templates/main/partial/loading.overlay.html">

                <h3> {{ 'DETAILVIEW_TABLE_HEADER' | translate }} </h3>
                <table class="table table-bordered table-hover table-header-styles">
                    <thead>
                    </thead>

                    <tbody>
                        <tr data-ng-if="detailCtrl.results.creators != null &&
                        detailCtrl.results.reference__author != null && detailCtrl.results.reference__year != null
                        && detailCtrl.results.reference__title != null && detailCtrl.results.reference__journal__journal_short != null
                        && detailCtrl.results.reference__volume != null && detailCtrl.results.reference__pages != null
                        && detailCtrl.results.reference__doi != null">
                            <td> {{ 'API_TRANSLATION.DOI.CITATION' | translate }} </td>
                            <td>
                                {{ detailCtrl.results.creators
                                + " ("
                                + detailCtrl.results.publication_year
                                + "): "
                                + detailCtrl.results.title
                                + ". "
                                + detailCtrl.results.publisher
                                + ". doi:"
                                + detailCtrl.results.identifier
                                + ". Supplement to: "
                                + detailCtrl.results.reference__author
                                + " ("
                                + detailCtrl.results.reference__year
                                + "): "
                                + detailCtrl.results.reference__title
                                + ". "
                                + detailCtrl.results.reference__journal__journal_short
                                + " "
                                + detailCtrl.results.reference__volume
                                + ": "
                                + detailCtrl.results.reference__pages
                                + ". doi:"
                                + detailCtrl.results.reference__doi
                                + ". " }}
                            </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.creators != null &&
                        (detailCtrl.results.reference__author === null || detailCtrl.results.reference__year === null
                        || detailCtrl.results.reference__title === null || detailCtrl.results.reference__journal__journal_short === null
                        || detailCtrl.results.reference__volume === null || detailCtrl.results.reference__pages === null
                        || detailCtrl.results.reference__doi === null)">
                            <td> {{ 'API_TRANSLATION.DOI.CITATION' | translate }} </td>
                            <td>
                                {{ detailCtrl.results.creators
                                + " ("
                                + detailCtrl.results.publication_year
                                + "): "
                                + detailCtrl.results.title
                                + ". "
                                + detailCtrl.results.publisher
                                + ". doi:"
                                + detailCtrl.results.identifier }}
                            </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.identifier && detailCtrl.results.identifier != null">
                            <td> {{ 'API_TRANSLATION.DOI.IDENTIFIER ' | translate }} </td>
                            <td> {{ detailCtrl.results.identifier }} </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.resource_type__value && detailCtrl.results.resource_type__value != null " >
                            <td> {{ 'API_TRANSLATION.DOI.RESOURCE_TYPE__VALUE ' | translate }} </td>
                            <td>{{detailCtrl.results.resource_type__value}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.resource && detailCtrl.results.resource != null " >
                            <td> {{ 'API_TRANSLATION.DOI.RESOURCE ' | translate }} </td>
                            <td>{{detailCtrl.results.resource}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.creators && detailCtrl.results.creators != null " >
                            <td> {{ 'API_TRANSLATION.DOI.CREATORS ' | translate }} </td>
                            <td>{{detailCtrl.results.creators}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.title && detailCtrl.results.title != null " >
                            <td> {{ 'API_TRANSLATION.DOI.TITLE' | translate }} </td>
                            <td> {{ detailCtrl.results.title }} </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.publisher && detailCtrl.results.publisher != null " >
                            <td> {{ 'API_TRANSLATION.DOI.PUBLISHER ' | translate }} </td>
                            <td>{{detailCtrl.results.publisher}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.publication_year && detailCtrl.results.publication_year != null " >
                            <td> {{ 'API_TRANSLATION.DOI.PUBLICATION_YEAR ' | translate }} </td>
                            <td>{{detailCtrl.results.publication_year}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.subjects && detailCtrl.results.subjects != null " >
                            <td> {{ 'API_TRANSLATION.DOI.SUBJECTS ' | translate }} </td>
                            <td>{{detailCtrl.results.subjects}}</td>
                        </tr>

                        <tr data-ng-if="(detailCtrl.results.language__value && detailCtrl.results.language__value != null) || (detailCtrl.results.language__value_en && detailCtrl.results.language__value_en != null) ">
                            <td>
                                <localize-label et="'API_TRANSLATION.DOI.LANGUAGE__VALUE'" en="'API_TRANSLATION.DOI.LANGUAGE__VALUE_EN'"/>
                            </td>
                            <td>
                                <localize et="detailCtrl.results.language__value" en="detailCtrl.results.language__value_en"/>
                            </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.abstract && detailCtrl.results.abstract != null " >
                            <td> {{ 'API_TRANSLATION.DOI.ABSTRACT ' | translate }} </td>
                            <td>{{detailCtrl.results.abstract}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.methods && detailCtrl.results.methods != null " >
                            <td> {{ 'API_TRANSLATION.DOI.METHODS ' | translate }} </td>
                            <td>{{detailCtrl.results.methods}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.version && detailCtrl.results.version != null " >
                            <td> {{ 'API_TRANSLATION.DOI.VERSION ' | translate }} </td>
                            <td>{{detailCtrl.results.version}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.formats && detailCtrl.results.formats != null " >
                            <td> {{ 'API_TRANSLATION.DOI.FORMATS ' | translate }} </td>
                            <td>{{detailCtrl.results.formats}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.sizes && detailCtrl.results.sizes != null " >
                            <td> {{ 'API_TRANSLATION.DOI.SIZES ' | translate }} </td>
                            <td>{{detailCtrl.results.sizes}}</td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.copyright_agent__institution_name != null
                            && detailCtrl.results.copyright_agent__institution_name_en != null " >
                            <td> {{ 'API_TRANSLATION.DOI.COPYRIGHT_AGENT__AGENT ' | translate }} </td>
                            <td>
                                <localize et="detailCtrl.results.copyright_agent__institution_name"
                                          en="detailCtrl.results.copyright_agent__institution_name_en" />
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <localize-label et="'API_TRANSLATION.DOI.LICENCE__LICENCE_EN'" en="'API_TRANSLATION.DOI.LICENCE__LICENCE_EN'"/>
                            </td>
                            <td>
                                <a href data-ng-click="detailCtrl.service.openUrlInNewWindow({url:detailCtrl.results.licence__licence_url_en})">
                                    <localize et="detailCtrl.results.licence__licence_en" en="detailCtrl.results.licence__licence_en"/>
                                </a>
                            </td>
                        </tr>

                        <tr data-ng-if="(detailCtrl.results.dataset__name && detailCtrl.results.dataset__name != null) || (detailCtrl.results.dataset__name_en && detailCtrl.results.dataset__name_en != null) ">
                            <td>
                                <localize-label et="'API_TRANSLATION.DOI.DATASET__NAME'" en="'API_TRANSLATION.DOI.DATASET__NAME_EN'"/>
                            </td>
                            <td>
                                <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'dataset', id: detailCtrl.results.dataset_id})"
                                   data-ng-if="detailCtrl.results.dataset_id && detailCtrl.results.dataset_id != null">
                                    <localize et="detailCtrl.results.dataset__name" en="detailCtrl.results.dataset__name_en"/>
                                </a>
                            </td>
                        </tr>

                        <tr data-ng-if="detailCtrl.results.reference__reference && detailCtrl.results.reference__reference != null">
                            <td> {{ 'API_TRANSLATION.DOI.RELATED_REFERENCE' | translate }} </td>
                            <td>
                                <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'reference', id: detailCtrl.results.reference_id})"
                                   data-ng-if="detailCtrl.results.reference_id && detailCtrl.results.reference_id != null">
                                    {{ detailCtrl.results.reference__reference }}
                                </a>
                            </td>
                        </tr>
                        <tr data-ng-if="detailCtrl.results.date_added && detailCtrl.results.date_added != null " >
                            <td> {{ 'API_TRANSLATION.DOI.DATE_ADDED ' | translate }} </td>
                            <td>{{detailCtrl.results.date_added | date:dateFormat}}</td>
                        </tr>
                        <tr data-ng-if="detailCtrl.results.date_changed && detailCtrl.results.date_changed != null " >
                            <td> {{ 'API_TRANSLATION.DOI.DATE_CHANGED ' | translate }} </td>
                            <td>{{detailCtrl.results.date_changed | date:dateFormat}}</td>
                        </tr>
                        <tr data-ng-if="detailCtrl.results.datacite_created && detailCtrl.results.datacite_created != null " >
                            <td> {{ 'API_TRANSLATION.DOI.DATACITE_CREATED ' | translate }} </td>
                            <td>{{detailCtrl.results.datacite_created | date:dateFormat}}</td>
                        </tr>
                        <tr data-ng-if="detailCtrl.results.datacite_updated && detailCtrl.results.datacite_updated != null " >
                            <td> {{ 'API_TRANSLATION.DOI.DATACITE_UPDATED ' | translate }} </td>
                            <td>{{detailCtrl.results.datacite_updated | date:dateFormat}}</td>
                        </tr>

                    </tbody>
                </table>
            </div>

            <div class="col-sm-6">
                <div data-ng-if="detailCtrl.doiAttachment.length > 0">
                    <h3> {{ 'DETAIL.DETAIL_DOWNLOAD' | translate }} </h3>
                    <div class="table-responsive">

                        <table class="table table-bordered table-hover">
                            <thead class="styles-for-table-headers">
                            <tr>
                                <th> {{ 'API_TRANSLATION.DOI.TYPE' | translate }} </th>
                                <th> {{ 'API_TRANSLATION.DOI.DESCRIPTION' | translate }} </th>
                                <th> {{ 'API_TRANSLATION.DOI.FORMATS' | translate }} </th>
                                <th> {{ 'API_TRANSLATION.DOI.PREVIEW' | translate }} </th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr data-ng-repeat="entity in detailCtrl.doiAttachment">
                                <td><localize et="entity.type__value" en="entity.type__value_en" /></td>
                                <td><localize et="entity.description" en="entity.description_en" /></td>
                                <td>{{entity.attachment_format__value}}</td>

                                <td class="text-center">
                                    <a target="_blank" ng-href="{{detailCtrl.service.getDownloadLink(entity.filename)}}">
                                        <i data-ng-if="entity.filename.endsWith('pdf')"
                                           title="{{detailCtrl.service.getDownloadLink(entity.filename)}}"
                                           class="fa fa-file-pdf-o fa-2x" aria-hidden="true"></i>

                                        <i data-ng-if="entity.filename.endsWith('txt')"
                                           title="{{detailCtrl.service.getDownloadLink(entity.filename)}}"
                                           class="fa fa-file-text-o fa-2x" aria-hidden="true"></i>

                                        <i data-ng-if="entity.filename.endsWith('xlsx') || entity.filename.endsWith('ods') || entity.filename.endsWith('xls')"
                                           title="{{detailCtrl.service.getDownloadLink(entity.filename)}}"
                                           class="fa fa-file-excel-o fa-2x" aria-hidden="true"></i>

                                        <img title="{{detailCtrl.service.getDownloadLink(entity.filename)}}"
                                             data-ng-if="entity.filename.endsWith('png') || entity.filename.endsWith('jpeg') || entity.filename.endsWith('svg') || entity.filename.endsWith('jpg')"
                                             class="previewImage"
                                             src="{{detailCtrl.service.getDownloadLink(entity.filename)}}"/>
                                    </a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div data-ng-if="detailCtrl.doiAgent.length > 0">
                    <h3> {{ 'DETAIL.DETAIL_RELATIONS' | translate }} </h3>
                    <table class="table table-bordered table-hover">
                        <thead class="styles-for-table-headers">
                        <tr>
                            <th> {{ 'API_TRANSLATION.DOI.NAME' | translate }} </th>
                            <th> {{ 'API_TRANSLATION.DOI.AFFILIATION' | translate }} </th>
                            <th> {{ 'API_TRANSLATION.DOI.RELATION' | translate }} </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr data-ng-repeat="entity in detailCtrl.doiAgent">
                            <td>{{entity.name}}</td>
                            <td>{{entity.affiliation}}</td>
                            <td>{{entity.agent_type__value}}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div data-ng-if="detailCtrl.doiRelatedIdentifier.length > 0">
                    <h3> {{ 'DETAIL.DETAIL_IDENTIFIERS' | translate }} </h3>

                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="styles-for-table-headers">
                            <tr>
                                <th> {{ 'API_TRANSLATION.DOI.RELATION' | translate }} </th>
                                <th> {{ 'API_TRANSLATION.DOI.RELATED_IDENTIFIER' | translate }} </th>
                                <th> {{ 'API_TRANSLATION.DOI.VALUE' | translate }} </th>
                                <th> {{ 'API_TRANSLATION.DOI.REMARKS' | translate }} </th>
                                <th>Link</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr data-ng-repeat="entity in detailCtrl.doiRelatedIdentifier">
                                <td>{{entity.relation_type__value}}</td>
                                <td>{{entity.identifier_type__value}}</td>
                                <td class="related-break-all">{{entity.value}}</td>
                                <td>{{ entity.remarks }}</td>
                                <td>
                                    <a href data-ng-if="entity.value && entity.value != null"
                                       data-ng-click="detailCtrl.service.openDoiInNewWindow({doi:entity.value})">
                                        <i title="{{entity.value}}" class="fa fa-file-text-o fa-2x" aria-hidden="true"></i>
                                    </a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div data-ng-if="detailCtrl.doiGeolocation.length > 0">
                    <h3> {{ 'DETAIL.DETAIL_GEOLOCATIONS' | translate }} </h3>
                    <table class="table table-bordered table-hover">
                        <thead class="styles-for-table-headers">
                        <tr>
                            <th> {{ 'API_TRANSLATION.DOI.PLACE' | translate }} </th>
                            <th> {{ 'API_TRANSLATION.DOI.POINT' | translate }} </th>
                            <th> {{ 'API_TRANSLATION.DOI.LOCALITY_DB' | translate }} </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr data-ng-repeat="entity in detailCtrl.doiGeolocation">
                            <td>{{entity.place}}</td>
                            <td>{{entity.point}}</td>
                            <td>
                                <a href data-ng-if="entity.locality_id && entity.locality_id != null"
                                   data-ng-click="detailCtrl.service.openInNewWindow({object:'locality',id:entity.locality_id})">
                                    <localize en="entity.locality__locality_en" et="entity.locality__locality"/>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div data-ng-if="detailCtrl.doiGeolocation.length > 0">
                    <h3> {{ 'DETAIL.DETAIL_MAP' | translate }} </h3>
                    <div id='hoverbox' class='coupontooltip'>
                        <div id='hoversystem'></div>
                        <div id='hoverstat'></div>
                    </div>
                    <localities-map localities="detailCtrl.localities"></localities-map>
                    <a href data-ng-click="detailCtrl.service.showGoogleMap(detailCtrl.localities[0].latitude, detailCtrl.localities[0].longitude, detailCtrl.localities[0].localityEng)">Google Maps</a></span>
                    &ensp;&ensp;|&ensp;&ensp; <a href data-ng-click="detailCtrl.service.showEstonianLandBoardMap(detailCtrl.localities[0].latitude, detailCtrl.localities[0].longitude)">{{ 'ESTONIAN_LAND_BOARD' | translate }}</a>

                </div>

            </div>
        </div>

        <div class="row">
            <div class="col-sm-12" data-ng-if="ifDoiAttachmentContainsShowableFiles(detailCtrl.doiAttachment)">

                <!--TODO: Fix this heading to only exist if txt or image-->
                <h3>{{ 'DETAIL.DETAIL_PREVIEW_DATA' | translate }}</h3>
                <div data-ng-repeat="entity in detailCtrl.doiAttachment">

                    <div class="table-responsive" data-ng-if="entity.filename.endsWith('txt')">

                        <!--<a data-fancybox data-type="iframe" data-src="http://geokogud.info/files/47/47aa3e41f32c906852388e0481396872.txt" href="javascript:;">-->
                            <!--Webpage-->
                        <!--</a>-->

                        <iframe id="iframe-text-file" style="width: 100%; height: 500px"
                                ngf-src="detailCtrl.service.getDownloadLink(entity.filename)"></iframe>

                    </div>

                    <div class="row" data-ng-if="entity.filename.endsWith('png') || entity.filename.endsWith('jpeg') || entity.filename.endsWith('jpg')">
                        <div class="col-sm-12">
                            <h4 class="text-center">
                                <localize et="entity.description" en="entity.description_en"/>
                            </h4>
                            <div class="border-none">
                                <a href target="_blank" ng-href="{{detailCtrl.service.getDownloadLink(entity.filename)}}">
                                    <img class="doi-big-image" title="{{detailCtrl.service.getDownloadLink(entity.filename)}}"
                                         src="{{detailCtrl.service.getDownloadLink(entity.filename)}}" />
                                </a>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>

    <div data-ng-if="detailCtrl.results == null && pageHasError" ng-include="'app/templates/main/detailview_error.html'"></div>

</div>

<div ng-include="'app/templates/main/partial/detailview_footer.html'"></div>

<script>
    $(function(){
        $('#elementToFocus').focus();
    });
</script>