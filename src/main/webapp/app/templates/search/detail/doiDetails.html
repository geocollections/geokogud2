<div ng-include="'app/templates/main/partial/detailview_header.html'"></div>

<div class="panel detailview-page">
    <div class="panel-body">

        <div class="row">
            <div class="col-sm-12">
                <div class="detailview-title">
                    <h3>{{detailCtrl.results.identifier}}: {{detailCtrl.results.title}}</h3>
                    <!--<h4>-->
                        <!--<em>(ID: {{detailCtrl.results.id}})</em>-->
                    <!--</h4>-->
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6" bs-loading-overlay bs-loading-overlay-reference-id="detailView" bs-loading-overlay-template-url="app/templates/main/partial/loading.overlay.html">

                <h3> {{ 'DETAILVIEW_TABLE_HEADER' | translate }} </h3>
                <table class="table table-bordered table-hover table-header-styles">
                    <thead>
                    </thead>

                    <tbody>
                    <!--  <tr data-ng-repeat="field in detailCtrl.fields" data-ng-if="detailCtrl.results[field] != null  && detailCtrl.results[field] != '' && detailCtrl.isIncludedField(field)">
                        <td entity-field-name name="'API_TRANSLATION.DOI.'+field | uppercase"></td>
                        <td entity-field-value name = "field" value="detailCtrl.results[field]" values = "detailCtrl.results"></td>
                    </tr>-->
                    <!--<tr data-ng-if="detailCtrl.results.id && detailCtrl.results.id != null " >-->
                        <!--<td> {{ 'API_TRANSLATION.DOI.ID ' | translate }} </td>-->
                        <!--<td>{{detailCtrl.results.id}}</td>-->
                    <!--</tr>-->
<!-- reference__author,reference__year,reference__title,reference__journal__journal_short,reference__volume,reference__pages,reference__doi -->
                    <tr data-ng-if="detailCtrl.results.creators != null &&
                    detailCtrl.results.reference__author != null && detailCtrl.results.reference__year != null
                    && detailCtrl.results.reference__title != null && detailCtrl.results.reference__journal__journal_short != null
                    && detailCtrl.results.reference__volume != null && detailCtrl.results.reference__pages != null
                    && detailCtrl.results.reference__doi != null">
                        <td> {{ 'API_TRANSLATION.DOI.CITATION' | translate }} </td>
                        <td>
                            {{ detailCtrl.results.creators
                            + " ("
                            + detailCtrl.results.publication_year
                            + "): "
                            + detailCtrl.results.title
                            + ". "
                            + detailCtrl.results.publisher
                            + ". doi:"
                            + detailCtrl.results.identifier
                            + ". Supplement to: "
                            + detailCtrl.results.reference__author
                            + " ("
                            + detailCtrl.results.reference__year
                            + "): "
                            + detailCtrl.results.reference__title
                            + ". "
                            + detailCtrl.results.reference__journal__journal_short
                            + " "
                            + detailCtrl.results.reference__volume
                            + ": "
                            + detailCtrl.results.reference__pages
                            + ". doi:"
                            + detailCtrl.results.reference__doi
                            + ". " }}
                        </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.creators != null &&
                    (detailCtrl.results.reference__author == null || detailCtrl.results.reference__year == null
                    || detailCtrl.results.reference__title == null || detailCtrl.results.reference__journal__journal_short == null
                    || detailCtrl.results.reference__volume == null || detailCtrl.results.reference__pages == null
                    || detailCtrl.results.reference__doi == null)">
                        <td> {{ 'API_TRANSLATION.DOI.CITATION' | translate }} </td>
                        <td>
                            {{ detailCtrl.results.creators
                            + " ("
                            + detailCtrl.results.publication_year
                            + "): "
                            + detailCtrl.results.title
                            + ". "
                            + detailCtrl.results.publisher
                            + ". doi:"
                            + detailCtrl.results.identifier }}
                        </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.identifier && detailCtrl.results.identifier != null">
                        <td> {{ 'API_TRANSLATION.DOI.IDENTIFIER ' | translate }} </td>
                        <td> {{ detailCtrl.results.identifier }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.resource_type__value && detailCtrl.results.resource_type__value != null " >
                        <td> {{ 'API_TRANSLATION.DOI.RESOURCE_TYPE__VALUE ' | translate }} </td>
                        <td>{{detailCtrl.results.resource_type__value}}</td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.resource && detailCtrl.results.resource != null " >
                        <td> {{ 'API_TRANSLATION.DOI.RESOURCE ' | translate }} </td>
                        <td>{{detailCtrl.results.resource}}</td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.creators && detailCtrl.results.creators != null " >
                        <td> {{ 'API_TRANSLATION.DOI.CREATORS ' | translate }} </td>
                        <td>{{detailCtrl.results.creators}}</td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.title && detailCtrl.results.title != null " >
                        <td> {{ 'API_TRANSLATION.DOI.TITLE' | translate }} </td>
                        <td> {{ detailCtrl.results.title }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.publisher && detailCtrl.results.publisher != null " >
                        <td> {{ 'API_TRANSLATION.DOI.PUBLISHER ' | translate }} </td>
                        <td>{{detailCtrl.results.publisher}}</td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.publication_year && detailCtrl.results.publication_year != null " >
                        <td> {{ 'API_TRANSLATION.DOI.PUBLICATION_YEAR ' | translate }} </td>
                        <td>{{detailCtrl.results.publication_year}}</td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.subjects && detailCtrl.results.subjects != null " >
                        <td> {{ 'API_TRANSLATION.DOI.SUBJECTS ' | translate }} </td>
                        <td>{{detailCtrl.results.subjects}}</td>
                    </tr>

                    <tr data-ng-if="(detailCtrl.results.language__value && detailCtrl.results.language__value != null) || (detailCtrl.results.language__value_en && detailCtrl.results.language__value_en != null) ">
                        <td>
                            <localize-label et="'API_TRANSLATION.DOI.LANGUAGE__VALUE'" en="'API_TRANSLATION.DOI.LANGUAGE__VALUE_EN'"/>
                        </td>
                        <td>
                            <localize et="detailCtrl.results.language__value" en="detailCtrl.results.language__value_en"/>
                        </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.abstract && detailCtrl.results.abstract != null " >
                        <td> {{ 'API_TRANSLATION.DOI.ABSTRACT ' | translate }} </td>
                        <td>{{detailCtrl.results.abstract}}</td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.methods && detailCtrl.results.methods != null " >
                        <td> {{ 'API_TRANSLATION.DOI.METHODS ' | translate }} </td>
                        <td>{{detailCtrl.results.methods}}</td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.version && detailCtrl.results.version != null " >
                        <td> {{ 'API_TRANSLATION.DOI.VERSION ' | translate }} </td>
                        <td>{{detailCtrl.results.version}}</td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.formats && detailCtrl.results.formats != null " >
                        <td> {{ 'API_TRANSLATION.DOI.FORMATS ' | translate }} </td>
                        <td>{{detailCtrl.results.formats}}</td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.sizes && detailCtrl.results.sizes != null " >
                        <td> {{ 'API_TRANSLATION.DOI.SIZES ' | translate }} </td>
                        <td>{{detailCtrl.results.sizes}}</td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.copyright_agent__agent && detailCtrl.results.copyright_agent__agent != null " >
                        <td> {{ 'API_TRANSLATION.DOI.COPYRIGHT_AGENT__AGENT ' | translate }} </td>
                        <td>
                            <!---->
                                {{detailCtrl.results.copyright_agent__agent}}
                            <!--</a>-->
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <localize-label et="'API_TRANSLATION.DOI.LICENCE__LICENCE_EN'" en="'API_TRANSLATION.DOI.LICENCE__LICENCE_EN'"/>
                        </td>
                        <td>
                            <a href data-ng-click="detailCtrl.service.openUrlInNewWindow({url:detailCtrl.results.licence__licence_url_en})">
                                <localize et="detailCtrl.results.licence__licence_en" en="detailCtrl.results.licence__licence_en"/>
                            </a>
                        </td>
                    </tr>

                    <tr data-ng-if="(detailCtrl.results.dataset__name && detailCtrl.results.dataset__name != null) || (detailCtrl.results.dataset__name_en && detailCtrl.results.dataset__name_en != null) ">
                        <td>
                            <localize-label et="'API_TRANSLATION.DOI.DATASET__NAME'" en="'API_TRANSLATION.DOI.DATASET__NAME_EN'"/>
                        </td>
                        <td>
                            <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'dataset', id: detailCtrl.results.dataset_id})"
                               data-ng-if="detailCtrl.results.dataset_id && detailCtrl.results.dataset_id != null">
                                <localize et="detailCtrl.results.dataset__name" en="detailCtrl.results.dataset__name_en"/>
                            </a>
                        </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.reference__reference && detailCtrl.results.reference__reference != null">
                        <td> {{ 'API_TRANSLATION.DOI.RELATED_REFERENCE' | translate }} </td>
                        <td>
                            <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'reference', id: detailCtrl.results.reference_id})"
                               data-ng-if="detailCtrl.results.reference_id && detailCtrl.results.reference_id != null">
                                {{ detailCtrl.results.reference__reference }}
                            </a>
                        </td>
                    </tr>
                    <tr data-ng-if="detailCtrl.results.date_added && detailCtrl.results.date_added != null " >
                        <td> {{ 'API_TRANSLATION.DOI.DATE_ADDED ' | translate }} </td>
                        <td>{{detailCtrl.results.date_added | date:'MMM d, yyyy HH:mm:ss'}}</td>
                    </tr>
                    <tr data-ng-if="detailCtrl.results.date_changed && detailCtrl.results.date_changed != null " >
                        <td> {{ 'API_TRANSLATION.DOI.DATE_CHANGED ' | translate }} </td>
                        <td>{{detailCtrl.results.date_changed | date:'MMM d, yyyy HH:mm:ss'}}</td>
                    </tr>
                    <tr data-ng-if="detailCtrl.results.datacite_created && detailCtrl.results.datacite_created != null " >
                        <td> {{ 'API_TRANSLATION.DOI.DATACITE_CREATED ' | translate }} </td>
                        <td>{{detailCtrl.results.datacite_created | date:'MMM d, yyyy HH:mm:ss'}}</td>
                    </tr>
                    <tr data-ng-if="detailCtrl.results.datacite_updated && detailCtrl.results.datacite_updated != null " >
                        <td> {{ 'API_TRANSLATION.DOI.DATACITE_UPDATED ' | translate }} </td>
                        <td>{{detailCtrl.results.datacite_updated | date:'MMM d, yyyy HH:mm:ss'}}</td>
                    </tr>

                    </tbody>
                </table>
            </div>

            <div class="col-sm-6" data-ng-if="detailCtrl.files.length > 0">
                <h3> {{ 'DETAIL.DETAIL_DOWNLOAD' | translate }} </h3>
                <table class="table table-bordered table-hover">
                    <thead class="styles-for-table-headers">
                    <tr>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Format</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                        <tr style="cursor: pointer; " data-ng-repeat="entity in detailCtrl.files">
                            <td>Data file</td>
                            <td>{{detailCtrl.results['title']}}</td>
                            <td>{{detailCtrl.results['formats'] | split:';':$index}}</td>
                            <td>
                                <a href target="_self" ng-href="{{detailCtrl.service.getDownloadLink(entity.fileName)}}">Download</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="col-sm-6" data-ng-if="detailCtrl.doiAgent.length > 0">
                <h3> {{ 'DETAIL.DETAIL_RELATIONS' | translate }} </h3>
                <table class="table table-bordered table-hover">
                    <thead class="styles-for-table-headers">
                    <tr>
                        <th>Name</th>
                        <th>Affiliation</th>
                        <th>Relation</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr style="cursor: pointer; " data-ng-repeat="entity in detailCtrl.doiAgent">
                        <td>{{entity.name}}</td>
                        <td>{{entity.affiliation}}</td>
                        <td>{{entity.agent_type__value}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="col-sm-6" data-ng-if="detailCtrl.doiRelatedIdentifier.length > 0">
                <h3> {{ 'DETAIL.DETAIL_IDENTIFIERS' | translate }} </h3>
                <table class="table table-bordered table-hover">
                    <thead class="styles-for-table-headers">
                    <tr>
                        <th>Relation</th>
                        <th>Identifier</th>
                        <th>Value</th>
                        <th>Remarks</th>
                        <th>Link</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr style="cursor: pointer; " data-ng-repeat="entity in detailCtrl.doiRelatedIdentifier">
                        <td>{{entity.relation_type__value}}</td>
                        <td>{{entity.identifier_type__value}}</td>
                        <td>{{entity.value}}</td>
                        <td>{{ entity.remarks }}</td>
                        <td data-ng-if="entity.identifier_type__value != 'URL'">
                            <a href data-ng-click="detailCtrl.service.openDoiInNewWindow({doi:entity.value})">
                                Link
                            </a>
                        </td>
                        <td data-ng-if="entity.identifier_type__value == 'URL'">
                            <a href data-ng-click="detailCtrl.service.openUrlInNewWindow({url:entity.value})">
                                Link
                            </a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="col-sm-6" data-ng-if="detailCtrl.doiGeolocation.length > 0">
                <h3> {{ 'DETAIL.DETAIL_GEOLOCATIONS' | translate }} </h3>
                <table class="table table-bordered table-hover">
                    <thead class="styles-for-table-headers">
                    <tr>
                        <th>Named place</th>
                        <th>Point (Lat Long)</th>
                        <th data-ng-if="detailCtrl.doiGeolocation.box != null">Bounding box</th>
                        <th>Locality from database</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr style="cursor: pointer; " data-ng-repeat="entity in detailCtrl.doiGeolocation">
                        <td>{{entity.place}}</td>
                        <td>{{entity.point}}</td>
                        <td data-ng-if="detailCtrl.doiGeolocation.box != null">{{entity.box}}</td>
                        <td>
                            <a href data-ng-if="entity.locality_id && entity.locality_id != null"
                               data-ng-click="detailCtrl.service.openInNewWindow({object:'locality',id:entity.locality_id})">
                                <localize en="entity.locality__locality_en" et="entity.locality__locality"/>
                            </a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="col-sm-6" data-ng-if="detailCtrl.doiGeolocation.length > 0">
                <h3> {{ 'DETAIL.DETAIL_MAP' | translate }} </h3>
                <div id='hoverbox' class='coupontooltip'>
                    <div id='hoversystem'></div>
                    <div id='hoverstat'></div>
                </div>
                <localities-map localities="detailCtrl.localities"></localities-map>
            </div>

            <div class="col-sm-6" data-ng-if="false">
                <h2>Preview data (for text files only)</h2>
            </div>

            <div class="col-sm-6" data-ng-if="false">
                <table class="table table-bordered table-hover">
                    <thead class="styles-for-table-headers">
                    <tr>
                        <th>Sample ID</th>
                        <th>Locality</th>
                        <th>Depth, m</th>
                        <th>Chronostratigraphy</th>
                        <th>Lithostratigraphy</th>
                        <th>delta13C</th>
                        <th>permil</th>
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<div ng-include="'app/templates/main/partial/detailview_footer.html'"></div>