<div ng-include="'app/templates/main/partial/detailview_header.html'"></div>

<div class="panel detailview-page">
    <div class="panel-body">

        <div class="row">
            <div class="col-sm-12">
                <div class="detailview-title">
                    <h2>
                        {{'API_TRANSLATION.LOCALITY.DETAIL_FORM_NAME' | translate }}
                        <localize et="detailCtrl.results.locality" en="detailCtrl.results.locality_en"/>
                    </h2>
                    <div>
                        <em>(ID: {{detailCtrl.results.id}})</em>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6" bs-loading-overlay bs-loading-overlay-reference-id="detailView" bs-loading-overlay-template-url="app/templates/main/partial/loading.overlay.html">

                <h3> {{ 'DETAILVIEW_TABLE_HEADER' | translate }} </h3>
                <table class="table table-bordered table-hover table-header-styles">

                    <tr data-ng-if="(detailCtrl.results.locality && detailCtrl.results.locality != null)
                        || (detailCtrl.results.locality_en && detailCtrl.results.locality_en != null) ">
                        <td>
                            <localize-label et="'API_TRANSLATION.LOCALITY.LOCALITY'" en="'API_TRANSLATION.LOCALITY.LOCALITY_EN'"/>
                        </td>
                        <td>
                            <localize et="detailCtrl.results.locality" en="detailCtrl.results.locality_en"/>
                        </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.number && detailCtrl.results.number != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.NUMBER ' |translate }} </td>
                        <td> {{ detailCtrl.results.number }} </td>
                    </tr>

                    <tr data-ng-if="(detailCtrl.results.type__value && detailCtrl.results.type__value != null)
                        || (detailCtrl.results.type__value_en && detailCtrl.results.type__value_en != null) ">
                        <td>
                            <localize-label et="'API_TRANSLATION.LOCALITY.TYPE__VALUE'" en="'API_TRANSLATION.LOCALITY.TYPE__VALUE_EN'"/>
                        </td>
                        <td>
                            <localize et="detailCtrl.results.type__value" en="detailCtrl.results.type__value_en"/>
                        </td>
                    </tr>

                    <tr data-ng-if="(detailCtrl.results.country__value && detailCtrl.results.country__value != null)
                        || (detailCtrl.results.country__value_en && detailCtrl.results.country__value_en != null) ">
                        <td>
                            <localize-label et="'API_TRANSLATION.LOCALITY.COUNTRY__VALUE'" en="'API_TRANSLATION.LOCALITY.COUNTRY__VALUE_EN'"/>
                        </td>
                        <td>
                            <localize et="detailCtrl.results.country__value" en="detailCtrl.results.country__value_en"/>
                        </td>
                    </tr>

                    <tr data-ng-if="(detailCtrl.results.maakond__maakond && detailCtrl.results.maakond__maakond != null)
                        || (detailCtrl.results.maakond__maakond_en && detailCtrl.results.maakond__maakond_en != null) ">
                        <td>
                            <localize-label et="'API_TRANSLATION.LOCALITY.MAAKOND__MAAKOND'"
                                            en="'API_TRANSLATION.LOCALITY.MAAKOND__MAAKOND_EN'"/>
                        </td>
                        <td>
                            <localize et="detailCtrl.results.maakond__maakond" en="detailCtrl.results.maakond__maakond_en"/>
                        </td>
                    </tr>

                    <tr data-ng-if="(detailCtrl.results.vald__vald && detailCtrl.results.vald__vald != null)
                        || (detailCtrl.results.vald__vald_en && detailCtrl.results.vald__vald_en != null) ">
                        <td>
                            <localize-label et="'API_TRANSLATION.LOCALITY.VALD__VALD'" en="'API_TRANSLATION.LOCALITY.VALD__VALD_EN'"/>
                        </td>
                        <td>
                            <localize et="detailCtrl.results.vald__vald" en="detailCtrl.results.vald__vald_en"/>
                        </td>
                    </tr>

                    <tr data-ng-if="(detailCtrl.results.asustusyksus__asustusyksus && detailCtrl.results.asustusyksus__asustusyksus != null)
                        || (detailCtrl.results.asustusyksus__asustusyksus_en && detailCtrl.results.asustusyksus__asustusyksus_en != null) ">
                        <td>
                            <localize-label et="'API_TRANSLATION.LOCALITY.ASUSTUSYKSUS__ASUSTUSYKSUS'"
                                            en="'API_TRANSLATION.LOCALITY.ASUSTUSYKSUS__ASUSTUSYKSUS_EN'"/>
                        </td>
                        <td>
                            <localize et="detailCtrl.results.asustusyksus__asustusyksus" en="detailCtrl.results.asustusyksus__asustusyksus_en"/>
                        </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.elevation && detailCtrl.results.elevation != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.ELEVATION ' | translate }} </td>
                        <td> {{ detailCtrl.results.elevation }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.latitude && detailCtrl.results.latitude != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.LATITUDE ' | translate }} </td>
                        <td> {{ detailCtrl.results.latitude }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.longitude && detailCtrl.results.longitude != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.LONGITUDE ' | translate }} </td>
                        <td> {{ detailCtrl.results.longitude }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.coord_system && detailCtrl.results.coord_system != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.COORD_SYSTEM ' | translate }} </td>
                        <td> {{ detailCtrl.results.coord_system }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.coordx && detailCtrl.results.coordx != null">
                        <td> {{'API_TRANSLATION.LOCALITY.COORDX ' | translate }} </td>
                        <td> {{ detailCtrl.results.coordx }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.coordy && detailCtrl.results.coordy != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.COORDY ' | translate }} </td>
                        <td> {{ detailCtrl.results.coordy }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.coord_det_precision__value && detailCtrl.results.coord_det_precision__value != null">
                        <td> {{'API_TRANSLATION.LOCALITY.COORD_DET_PRECISION__VALUE ' | translate }} </td>
                        <td> {{ detailCtrl.results.coord_det_precision__value }} </td>
                    </tr>

                    <tr data-ng-if="(detailCtrl.results.coord_det_method__value && detailCtrl.results.coord_det_method__value != null)
                        || (detailCtrl.results.coord_det_method__value_en && detailCtrl.results.coord_det_method__value_en != null) ">
                        <td>
                            <localize-label et="'API_TRANSLATION.LOCALITY.COORD_DET_METHOD__VALUE'"
                                            en="'API_TRANSLATION.LOCALITY.COORD_DET_METHOD__VALUE_EN'"/>
                        </td>
                        <td>
                            <localize et="detailCtrl.results.coord_det_method__value" en="detailCtrl.results.coord_det_method__value_en"/>
                        </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.coord_det_agent__agent && detailCtrl.results.coord_det_agent__agent != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.COORD_DET_AGENT__AGENT ' | translate }} </td>
                        <td> {{ detailCtrl.results.coord_det_agent__agent }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.parent__locality && detailCtrl.results.parent__locality != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.PARENT__LOCALITY ' | translate }} </td>
                        <td> {{ detailCtrl.results.parent__locality }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.remarks_location && detailCtrl.results.remarks_location != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.REMARKS_LOCATION ' |translate }} </td>
                        <td> {{ detailCtrl.results.remarks_location }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.depth && detailCtrl.results.depth != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.DEPTH ' | translate }} </td>
                        <td> {{ detailCtrl.results.depth }} </td>
                    </tr>

                    <tr data-ng-if="(detailCtrl.results.stratigraphy_top__stratigraphy && detailCtrl.results.stratigraphy_top__stratigraphy != null)
                        || (detailCtrl.results.stratigraphy_top__stratigraphy_en && detailCtrl.results.stratigraphy_top__stratigraphy_en != null) ">
                        <td>
                            <localize-label et="'API_TRANSLATION.LOCALITY.STRATIGRAPHY_TOP__STRATIGRAPHY'"
                                            en="'API_TRANSLATION.LOCALITY.STRATIGRAPHY_TOP__STRATIGRAPHY_EN'"/>
                        </td>
                        <td>
                            <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'stratigraphy', id: detailCtrl.results.stratigraphy_top_id})">
                                <localize et="detailCtrl.results.stratigraphy_top__stratigraphy"
                                          en="detailCtrl.results.stratigraphy_top__stratigraphy_en"/>
                            </a>
                        </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.stratigraphy_top_free && detailCtrl.results.stratigraphy_top_free != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.STRATIGRAPHY_TOP_FREE ' |translate }} </td>
                        <td> {{ detailCtrl.results.stratigraphy_top_free }} </td>
                    </tr>

                    <tr data-ng-if="(detailCtrl.results.stratigraphy_base__stratigraphy && detailCtrl.results.stratigraphy_base__stratigraphy != null)
                        || (detailCtrl.results.stratigraphy_base__stratigraphy_en && detailCtrl.results.stratigraphy_base__stratigraphy_en != null) ">
                        <td>
                            <localize-label et="'API_TRANSLATION.LOCALITY.STRATIGRAPHY_BASE__STRATIGRAPHY'"
                                            en="'API_TRANSLATION.LOCALITY.STRATIGRAPHY_BASE__STRATIGRAPHY_EN'"/>
                        </td>
                        <td>
                            <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'stratigraphy', id: detailCtrl.results.stratigraphy_base_id})">
                                <localize et="detailCtrl.results.stratigraphy_base__stratigraphy"
                                          en="detailCtrl.results.stratigraphy_base__stratigraphy_en"/>
                            </a>
                        </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.stratigraphy_base_free && detailCtrl.results.stratigraphy_base_free != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.STRATIGRAPHY_BASE_FREE ' |translate }} </td>
                        <td> {{ detailCtrl.results.stratigraphy_base_free }} </td>
                    </tr>
                    
                    <tr data-ng-if="detailCtrl.drillcores.length > 0" ng-repeat="entity in detailCtrl.drillcores | limitTo:1">
                        <td> {{ 'API_TRANSLATION.LOCALITY.DRILLCORE' | translate }} </td>
                        <td data-ng-if="entity.boxes != null">
                            <a href data-ng-click="detailCtrl.service.openInNewWindow({object:'drillcore',id:entity.id})">
                                {{entity.boxes}} {{ 'API_TRANSLATION.LOCALITY.COREBOX' | translate }}
                            </a>
                        </td>
                        <td data-ng-if="entity.boxes == null">
                            <a href data-ng-click="detailCtrl.service.openInNewWindow({object:'drillcore',id:entity.id})">
                                0 {{ 'API_TRANSLATION.LOCALITY.COREBOX' | translate }}
                            </a>
                        </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.localitystratigraphy__stratigraphy__stratigraphy_en
                        && detailCtrl.results.localitystratigraphy__stratigraphy__stratigraphy_en != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.LOCALITYSTRATIGRAPHY__STRATIGRAPHY__STRATIGRAPHY_EN ' | translate }}</td>
                        <td> {{ detailCtrl.results.localitystratigraphy__stratigraphy__stratigraphy_en }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.maaamet_pa_id && detailCtrl.results.maaamet_pa_id != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.MAAAMET_PA_ID ' | translate }} </td>
                        <td>
                            <a href data-ng-click="detailCtrl.service.openUrlInNewWindow({url:'http://geoportaal.maaamet.ee/index.php?&action=viewPA&page_id=382&pa_id='+detailCtrl.results.maaamet_pa_id})">
                                {{ detailCtrl.results.maaamet_pa_id }}
                            </a>
                        </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.eelis && detailCtrl.results.eelis != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.EELIS ' | translate }} </td>
                        <td> {{ detailCtrl.results.eelis }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.remarks && detailCtrl.results.remarks != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.REMARKS ' | translate }} </td>
                        <td> {{ detailCtrl.results.remarks }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.user_added && detailCtrl.results.user_added != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.USER_ADDED ' | translate }} </td>
                        <td> {{ detailCtrl.results.user_added }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.date_added && detailCtrl.results.date_added != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.DATE_ADDED ' | translate }} </td>
                        <td> {{ detailCtrl.results.date_added | date:dateFormat }} </td>
                    </tr>

                    <tr data-ng-if="detailCtrl.results.date_changed && detailCtrl.results.date_changed != null">
                        <td> {{ 'API_TRANSLATION.LOCALITY.DATE_CHANGED ' | translate }} </td>
                        <td> {{ detailCtrl.results.date_changed | date:dateFormat }} </td>
                    </tr>

                </table>
            </div>

            <div class="col-sm-6">

                <div data-ng-if="detailCtrl.locality.latitude && detailCtrl.locality.longitude">
                    <h3> {{ 'DETAIL.DETAIL_MAP' | translate }} </h3>
                    <div id='hoverbox' class='coupontooltip'>
                        <div id='hoversystem'></div>
                        <div id='hoverstat'></div>
                    </div>
                    <locality-map x = "detailCtrl.locality.latitude" y = "detailCtrl.locality.longitude" name = "detailCtrl.locality.localityEn" fid = "detailCtrl.locality.localityId"></locality-map>
                    <a href data-ng-click="detailCtrl.service.showGoogleMap(detailCtrl.locality.latitude, detailCtrl.locality.longitude, detailCtrl.locality.localityEn)">Google Maps</a></span>
                    &ensp;&ensp;|&ensp;&ensp; <a href data-ng-click="detailCtrl.service.showEstonianLandBoardMap(detailCtrl.locality.latitude, detailCtrl.locality.longitude)">Maa-amet / Estonian Land Board</a>
                </div>

                <div data-ng-if="detailCtrl.images.length > 0">
                    <h3> {{ 'DETAIL.LOCALITY.IMAGES_HEADING'| translate }} </h3>

                    <!--TODO: change ID and CLASS names to universal-->

                    <div id="specimen-images" class="row">

                        <div data-ng-repeat="entity in detailCtrl.images | orderBy : 'date_taken' : true"
                             data-ng-click="detailCtrl.service.openInNewWindow({object:'image', id:entity.id})"
                             class="col-lg-specimen-3 col-md-specimen-4 col-sm-specimen-6 col-sm-specimen-4 col-xs-6">

                            <show-preview-locality id="specimen-detail-image" img-title="[entity.author__agent, entity.date_taken, entity.date_taken_free]"
                                                   img-url="detailCtrl.service.composeImageUrl(entity)"/>

                        </div>
                    </div>

                    <!--<table class="table table-bordered table-hover">-->
                        <!--<thead class="styles-for-table-headers">-->
                        <!--<tr>-->
                            <!--<th>{{'DETAIL.LOCALITY.DATE' | translate }}</th>-->
                            <!--<th>{{'DETAIL.LOCALITY.AUTHOR' | translate }}</th>-->
                            <!--<th>{{'DETAIL.LOCALITY.DESCRIPTION' | translate }}</th>-->
                            <!--<th>{{'DETAIL.LOCALITY.TYPE' | translate }}</th>-->
                            <!--<th>{{'DETAIL.LOCALITY.LINK ' | translate }}</th>-->
                        <!--</tr>-->
                        <!--</thead>-->
                        <!--<tbody>-->
                        <!--<tr data-ng-repeat="entity in detailCtrl.images">-->
                            <!--<td>{{entity.date_added | date:dateFormat}}</td>-->
                            <!--<td>{{entity.author__forename}} {{entity.author__surename}}</td>-->
                            <!--<td>{{entity.description}}</td>-->
                            <!--<td><localize et="entity.type__value" en="entity.type__value_en"/></td>-->
                            <!--<td><a href data-ng-click="detailCtrl.service.openInNewWindow({object:'image',id:entity.id})"><img src="http://geokogud.info/git/image/{{entity.imageset__imageset_series}}/{{entity.imageset__imageset_number}}/preview/{{entity.filename}}"></a></td>-->
                        <!--</tr>-->
                        <!--</tbody>-->
                    <!--</table>-->
                </div>

                <div data-ng-if="detailCtrl.localitySynonyms.length > 0">
                    <h3> {{ 'DETAIL.LOCALITY.SYNONYMS_HEADING' | translate }} </h3>
                    <table class="table table-bordered table-hover">
                        <thead class="styles-for-table-headers">
                        <tr>
                            <th> {{ 'DETAIL.LOCALITY.NAME' | translate }} </th>
                            <th> {{ 'DETAIL.LOCALITY.REFERENCE' | translate }} </th>
                            <th> {{ 'DETAIL.LOCALITY.REFERENCE_PAGES' | translate }} </th>
                            <th> {{ 'DETAIL.LOCALITY.REFERENCE_REMARKS' | translate }} </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr data-ng-repeat="entity in detailCtrl.localitySynonyms" data-ng-if="entity.synonym && entity.synonym != null">
                            <td>{{entity.synonym}}</td>
                            <td>{{entity.reference__reference}}</td>
                            <td>{{entity.pages}}</td>
                            <td>{{entity.remarks}}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div data-ng-if="detailCtrl.specimens.length > 0">
                    <h3> {{ 'DETAIL.LOCALITY.SPECIMEN' | translate }} </h3>

                    <table class="table table-bordered table-hover margin-bottom-5">
                        <thead class="styles-for-table-headers">
                        <tr>
                            <th> {{ 'DETAIL.LOCALITY.ID' | translate }} </th>
                            <th> {{ 'DETAIL.LOCALITY.NAME' | translate }} </th>
                            <th> {{ 'DETAIL.LOCALITY.STRATIGRAPHY' | translate }} </th>
                            <th> {{ 'DETAIL.LOCALITY.STRATIGRAPHY_REMARKS' | translate }} </th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr data-ng-repeat="specimen in detailCtrl.specimens | limitTo:10">

                            <td data-ng-if="specimen.id != null">
                                <a href data-ng-click="detailCtrl.service.openInNewWindow({object:'specimen',id:specimen.id})">
                                    {{specimen.id}}
                                </a>
                            </td>

                            <td>
                                <a href data-ng-if="specimen.specimenidentification__taxon__taxon != null && specimen.specimenidentification__taxon_id != null"
                                   data-ng-click="detailCtrl.service.openUrlInNewWindow({url:'http://fossiilid.info/'+specimen.specimenidentification__taxon_id})">
                                    {{specimen.specimenidentification__taxon__taxon}}
                                </a>
                            </td>

                            <!--<td href data-ng-if="(specimen.specimenidentification__taxon__taxon == null && specimen.specimenidentification__taxon_id == null)-->
                                <!--&& specimen.specimenidentification__name != null">-->
                                <!--{{specimen.specimenidentification__name}}-->
                            <!--</td>-->

                            <!-- TODO: taxon_taxon -> name -> mineral_name + mineral_formula -> specimen_identification_geology_name -->

                            <td>
                                <a data-ng-click="detailCtrl.service.openInNewWindow({object: 'stratigraphy', id: specimen.stratigraphy__id})"
                                   href ng-if="specimen.stratigraphy__id != null">
                                    <localize et="specimen.stratigraphy__stratigraphy" en="specimen.stratigraphy__stratigraphy_en" />
                                </a>
                            </td>
                            <td> {{ specimen.stratigraphy_free }} </td>
                        </tr>
                        </tbody>

                    </table>

                    <a href data-ng-click="detailCtrl.service.searchAllSpecimenInLocality({locality: detailCtrl.results.locality})" target="_blank">
                        {{ 'DETAIL.LOCALITY.ALL_SPECIMEN' | translate}} ({{detailCtrl.specimens.length}})
                    </a>
                </div>

                <div data-ng-if="detailCtrl.localityReferences.length > 0">
                    <h3> {{ 'DETAIL.LOCALITY.REFERENCE_HEADING' | translate }} </h3>
                    <table class="table table-bordered table-hover">
                        <thead class="styles-for-table-headers">
                        <tr>
                            <th> {{ 'DETAIL.LOCALITY.REFERENCE' | translate }} </th>
                            <th> {{ 'DETAIL.LOCALITY.REFERENCE_PAGES' | translate }} </th>
                            <th> {{ 'DETAIL.LOCALITY.REFERENCE_FIGURES' | translate }} </th>
                            <th> {{ 'DETAIL.LOCALITY.REFERENCE_REMARKS' | translate }} </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr data-ng-repeat="entity in detailCtrl.localityReferences">
                            <td>
                                <a href data-ng-click="detailCtrl.service.openInNewWindow({object: 'reference', id: entity.reference_id})">{{entity.reference__reference}}</a>
                            <td>{{ entity.pages }}</td>
                            <td>{{ entity.figures }}</td>
                            <td>{{ entity.remarks }}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!--<div data-ng-if="detailCtrl.drillcores.length > 0">-->
                    <!--<h3> {{ 'DETAIL.DETAIL_DRILLCORES' | translate }} </h3>-->
                    <!--<table class="table table-bordered table-hover">-->
                        <!--<thead class="styles-for-table-headers">-->
                        <!--<tr>-->
                            <!--<th>Drillcore</th>-->
                            <!--<th>???</th>-->
                            <!--<th>???</th>-->
                        <!--</tr>-->
                        <!--</thead>-->
                        <!--<tbody>-->
                        <!--<tr data-ng-repeat="entity in detailCtrl.drillcores">-->
                            <!--<td><a href data-ng-click="detailCtrl.service.openInNewWindow({object:'drillcore',id:entity.id})">{{entity.drillcore}}</a></td>-->
                            <!--<td>???</td>-->
                            <!--<td>???</td>-->
                        <!--</tr>-->
                        <!--</tbody>-->
                    <!--</table>-->
                <!--</div>-->

            </div>
        </div>

    </div>
</div>

<div ng-include="'app/templates/main/partial/detailview_footer.html'"></div>